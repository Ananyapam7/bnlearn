

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Use Case Medical domain &mdash; bnlearn bnlearn documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="bnlearn.structure_learning" href="bnlearn.structure_learning.html" />
    <link rel="prev" title="Examples" href="Examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> bnlearn
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Quickstart.html">Quickstart</a></li>
</ul>
<p class="caption"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html#validate">Validate</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html#uninstalling">Uninstalling</a></li>
</ul>
<p class="caption"><span class="caption-text">Methods</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Structure learning.html">Structure learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Parameter learning.html">Parameter learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Inference.html">Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sampling and datasets.html">Sampling and datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Create DAG.html">Directed Acyclic Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="whitelist_blacklist.html">Black and white lists</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Use Case Medical domain</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="#import-data">Import data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-inferences-when-you-have-data-and-know-how">Make inferences when you have data and know-how</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-a-custom-directed-acyclic-graph">Create a custom Directed Acyclic Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compute-conditional-probability-distributions-cpds">Compute Conditional Probability Distributions (CPDs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#make-inferences">Make inferences</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#determine-causalities-when-you-have-data">Determine causalities when you have data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compute-directed-acyclic-graph-from-data">Compute Directed Acyclic Graph from data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#make-inference-when-you-have-data">Make inference when you have data</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bnlearn.structure_learning.html">bnlearn.structure_learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="bnlearn.parameter_learning.html">bnlearn.parameter_learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="bnlearn.inference.html">bnlearn.inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="bnlearn.bnlearn.html">bnlearn.bnlearn</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">bnlearn</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Use Case Medical domain</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/UseCases.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="use-case-medical-domain">
<h1>Use Case Medical domain<a class="headerlink" href="#use-case-medical-domain" title="Permalink to this headline">¶</a></h1>
<p>In this section I will describe the use-case to analyse patients treatment regarding shortness-of-breath (dyspnoea). In this context you may readily know some associatons from literature and/or experience, like smoking is related to dyspnoea. In this use-case I will demonstrate how to use your expert-knowledge in a bayesian model. Furthermore, the data set is small (few variables) and synthetic from Lauritzen and Spiegelhalter (1988), and is about lung diseases (tuberculosis, lung cancer or bronchitis) and visits to Asia.</p>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt>Motivation</dt><dd><p>“<em>Shortness-of-breath (dyspnoea) may be due to tuberculosis, lung cancer or bronchitis, or none of them, or more than one of them. A recent visit to Asia increases the chances of tuberculosis, while smoking is known to be a risk factor for both lung cancer and bronchitis. The results of a single chest X-ray do not discriminate between lung cancer and tuberculosis, as neither does the presence or absence of dyspnoea.</em>”</p>
</dd>
<dt>Source</dt><dd><p><em>Lauritzen S, Spiegelhalter D (1988). Local Computation with Probabilities on Graphical Structures and their Application to Expert Systems (with discussion). Journal of the Royal Statistical Society</em></p>
</dd>
</dl>
</div>
<div class="section" id="import-data">
<h2>Import data<a class="headerlink" href="#import-data" title="Permalink to this headline">¶</a></h2>
<p>The first step is to import the data set. If you have <strong>unstructured</strong> data, use the <code class="docutils literal notranslate"><span class="pre">df2onehot</span></code> functionality <a class="reference internal" href="bnlearn.bnlearn.html#bnlearn.bnlearn.df2onehot" title="bnlearn.bnlearn.df2onehot"><code class="xref py py-func docutils literal notranslate"><span class="pre">bnlearn.bnlearn.df2onehot()</span></code></a>. The <a class="reference internal" href="Examples.html#examples"><span class="std std-ref">Examples</span></a> section contains examples how to import a raw data set followed by (basic) structering approaches (section: <a class="reference internal" href="Examples.html#start-with-raw-data"><span class="std std-ref">Start with RAW data</span></a>). In my case I will load the data from <code class="docutils literal notranslate"><span class="pre">bnlearn</span></code>, which is readily a <strong>structured</strong> dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load dataset with 10.000 samples</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">import_example</span><span class="p">(</span><span class="s1">&#39;asia&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="c1"># Print to screen</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 10%" />
<col style="width: 14%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"><p>smoke</p></th>
<th class="head"><p>bronc</p></th>
<th class="head"><p>lung</p></th>
<th class="head"><p>asia</p></th>
<th class="head"><p>tub</p></th>
<th class="head"><p>either</p></th>
<th class="head"><p>dysp</p></th>
<th class="head"><p>xray</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
<tr class="row-even"><td><p>9999</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>This data set contains 8 variables with discrete values, meaning that the variables have the state yes/no, true/false or 1/0 values. <code class="docutils literal notranslate"><span class="pre">bnlearn</span></code> can handle multiple catagories (also non-numerical, <a class="reference internal" href="Examples.html#start-with-raw-data"><span class="std std-ref">Start with RAW data</span></a>). In this example we generate 10.000 samples (representing the patients). Note that the number of variables depends on the complexity of the data set (number of variables and the catagories per variable). If you want to get <em>feeling</em> of the performance of bayesian models, I would advice to play arround with various example data sets in <code class="docutils literal notranslate"><span class="pre">bnlearn</span></code> and determine when you can re-construct the entire DAG given the complexity of the data set. As an example, 1000 samples is sufficient for the <strong>sprinkler</strong> data set because there are only 4 variables, each with state yes/no. Some other data sets (such as <strong>alarm</strong>) are way more complicated and 1000 samples would not be sufficient.</p>
</div>
<div class="section" id="make-inferences-when-you-have-data-and-know-how">
<h2>Make inferences when you have data and know-how<a class="headerlink" href="#make-inferences-when-you-have-data-and-know-how" title="Permalink to this headline">¶</a></h2>
<p>Expert knowledge can be included in bayasian models by using graphs in the form of a Directed Acyclic Graphs (DAG, <a class="reference internal" href="Create DAG.html#directed-acyclic-graphs"><span class="std std-ref">Directed Acyclic Graphs</span></a>). The DAG describes the relationships between variables. Lets create a custom DAG, and make inferences <a class="reference internal" href="Inference.html#inference"><span class="std std-ref">Inference</span></a>.</p>
<dl class="simple">
<dt>Aim: Make inferences about shortness-of-breath (dyspnoea) when:</dt><dd><ol class="arabic simple">
<li><p>You have measured data and imported: <a class="reference internal" href="#import-data"><span class="std std-ref">Import data</span></a>.</p></li>
<li><p>You have know-how/expert knowledge.</p></li>
</ol>
</dd>
</dl>
<div class="section" id="create-a-custom-directed-acyclic-graph">
<h3>Create a custom Directed Acyclic Graph<a class="headerlink" href="#create-a-custom-directed-acyclic-graph" title="Permalink to this headline">¶</a></h3>
<p>My knowledge about <em>dyspnoea</em> is limited to: smoking is related to lung cancer, smoking is related to bronchitis, and if you have lung or bronchitus you may need an xray examination. Basically, I will create a simple DAG. Note that bayesian modeling is especially fun because you can make very complex DAGs. Note that the direction is very important. The first column is “from” or “source” and the second column “to” or “destination”. Note, this is a <strong>very simple model</strong> that is designed for demonstration purposes only.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">edges</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;smoke&#39;</span><span class="p">,</span> <span class="s1">&#39;lung&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;smoke&#39;</span><span class="p">,</span> <span class="s1">&#39;bronc&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;lung&#39;</span><span class="p">,</span> <span class="s1">&#39;xray&#39;</span><span class="p">),</span>
         <span class="p">(</span><span class="s1">&#39;bronc&#39;</span><span class="p">,</span> <span class="s1">&#39;xray&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Plot the Bayesian DAG.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the DAG from the edges</span>
<span class="n">DAG</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">make_DAG</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

<span class="c1"># Plot and make sure the arrows are correct.</span>
<span class="n">bnlearn</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">DAG</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" id="fig-lung-simple-dag">
<img alt="_images/lung_simple_dag.png" src="_images/lung_simple_dag.png" />
</div>
</div>
<div class="section" id="compute-conditional-probability-distributions-cpds">
<h3>Compute Conditional Probability Distributions (CPDs)<a class="headerlink" href="#compute-conditional-probability-distributions-cpds" title="Permalink to this headline">¶</a></h3>
<p>At this point we have the data set in our dataframe (df), and we have the <strong>DAG</strong> based on your expert knowledge. The next step is to connect your brains (DAG) to the data set. We can do this with the function <code class="xref py py-func docutils literal notranslate"><span class="pre">bnlearn.bnlearn.parameter_learning.fit()</span></code> which will compute the CPDs. See section <a class="reference internal" href="Parameter learning.html#parameter-learning"><span class="std std-ref">Parameter learning</span></a> to learn more about conditional probability distributions (CPDs) and how parameters can be learned. In general; it is the task to estimate the values of the CPDs in the DAG based on the input data set. How cool is that!</p>
<p>Parameter learning on the expert-DAG using the input data set.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check the current CPDs in the DAG.</span>
<span class="n">bnlearn</span><span class="o">.</span><span class="n">print_CPD</span><span class="p">(</span><span class="n">DAG</span><span class="p">)</span>
<span class="c1"># [bnlearn] &gt;No CPDs to print. Tip: use bnlearn.plot(DAG) to make a plot.</span>
<span class="c1"># This is correct, we dit not yet specify any CPD.</span>

<span class="c1"># Learn the parameters from data set.</span>
<span class="c1"># As input we have the DAG without CPDs.</span>
<span class="n">DAG</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">parameter_learning</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">DAG</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">methodtype</span><span class="o">=</span><span class="s1">&#39;bayes&#39;</span><span class="p">)</span>

<span class="c1"># Print the CPDs</span>
<span class="n">bnlearn</span><span class="o">.</span><span class="n">print_CPD</span><span class="p">(</span><span class="n">DAG</span><span class="p">)</span>
<span class="c1"># At this point we have a DAG with the learned CPDs</span>
</pre></div>
</div>
<p>The learned Conditional Probability Distributions are depicted in the tables below. As an example, the probability that a patient does <strong>not</strong> smoke is P(smoke=0)=0.49 whereas the probability of a patient smoking is P(smoke=1)=0.5.</p>
<p>CPD of smoke:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>smoke(0)</p></td>
<td><p>0.495273</p></td>
</tr>
<tr class="row-even"><td><p>smoke(1)</p></td>
<td><p>0.504727</p></td>
</tr>
</tbody>
</table>
<p>Slightly more complicated are the patients that smoke and have lung-cancer which is basically the intersection. The more edges towards a node the more complicated the CPD becomes. Luckily we have <code class="docutils literal notranslate"><span class="pre">bnlearn</span></code> to do the heavy lifting!</p>
<p>CPD of lung:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 41%" />
<col style="width: 41%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>smoke</p></td>
<td><p>smoke(0)</p></td>
<td><p>smoke(1)</p></td>
</tr>
<tr class="row-even"><td><p>lung(0)</p></td>
<td><p>0.13913362701908957</p></td>
<td><p>0.05457492795389049</p></td>
</tr>
<tr class="row-odd"><td><p>lung(1)</p></td>
<td><p>0.8608663729809104</p></td>
<td><p>0.9454250720461095</p></td>
</tr>
</tbody>
</table>
<p>CPD of bronc:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 40%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>smoke</p></td>
<td><p>smoke(0)</p></td>
<td><p>smoke(1)</p></td>
</tr>
<tr class="row-even"><td><p>bronc(0)</p></td>
<td><p>0.5936123348017621</p></td>
<td><p>0.3114193083573487</p></td>
</tr>
<tr class="row-odd"><td><p>bronc(1)</p></td>
<td><p>0.4063876651982379</p></td>
<td><p>0.6885806916426513</p></td>
</tr>
</tbody>
</table>
<p>CPD of xray:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 23%" />
<col style="width: 23%" />
<col style="width: 22%" />
<col style="width: 23%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>bronc</p></td>
<td><p>bronc(0)</p></td>
<td><p>bronc(0)</p></td>
<td><p>bronc(1)</p></td>
<td><p>bronc(1)</p></td>
</tr>
<tr class="row-even"><td><p>lung</p></td>
<td><p>lung(0)</p></td>
<td><p>lung(1)</p></td>
<td><p>lung(0)</p></td>
<td><p>lung(1)</p></td>
</tr>
<tr class="row-odd"><td><p>xray(0)</p></td>
<td><p>0.7651245551601423</p></td>
<td><p>0.08089070665757782</p></td>
<td><p>0.7334669338677354</p></td>
<td><p>0.08396533044420368</p></td>
</tr>
<tr class="row-even"><td><p>xray(1)</p></td>
<td><p>0.23487544483985764</p></td>
<td><p>0.9191092933424222</p></td>
<td><p>0.2665330661322645</p></td>
<td><p>0.9160346695557963</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="make-inferences">
<h3>Make inferences<a class="headerlink" href="#make-inferences" title="Permalink to this headline">¶</a></h3>
<p>When you are at this part, you combined your expert knowledge with a data set! Now we can make inferences which allows to ask questions to the model. Let me demonstrate a few questions.</p>
<p><strong>Question 1</strong></p>
<p>What is the probability of lung-cancer, given that we know that patient does smoke?
The model returns that the probability of lung-cancer or lung(1) is 0.94 when the patient does smoke; P(lung=1 | smoke=1)=0.94.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">q1</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">DAG</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lung&#39;</span><span class="p">],</span> <span class="n">evidence</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;smoke&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>

<span class="c1"># Finding Elimination Order: : 100% 2/2 [00:00&lt;00:00, 401.14it/s]</span>
<span class="c1"># Eliminating: bronc: 100%| 2/2 [00:00&lt;00:00, 200.50it/s]</span>
<span class="c1"># [bnlearn] &gt;Variable Elimination..</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>lung</p></th>
<th class="head"><p>phi(lung)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lung(0)</p></td>
<td><p>0.0546</p></td>
</tr>
<tr class="row-odd"><td><p>lung(1)</p></td>
<td><p>0.9454</p></td>
</tr>
</tbody>
</table>
<p><strong>Question 2</strong></p>
<p>What is the probability of bronchitis, given that we know that patient does smoke?
The model returns that the probability of bronchitis or bronc(1) is 0.68 when the patient does smoke; P(bronc=1 | smoke=1)=0.68.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">q2</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">DAG</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bronc&#39;</span><span class="p">],</span> <span class="n">evidence</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;smoke&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>

<span class="c1"># Finding Elimination Order: : 100% 2/2 [00:00&lt;00:00, 286.31it/s]</span>
<span class="c1"># Eliminating: lung: 100% 2/2 [00:00&lt;00:00, 143.26it/s]</span>
<span class="c1"># [bnlearn] &gt;Variable Elimination..</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 58%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>bronc</p></th>
<th class="head"><p>phi(bronc)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bronc(0)</p></td>
<td><p>0.3114</p></td>
</tr>
<tr class="row-odd"><td><p>bronc(1)</p></td>
<td><p>0.6886</p></td>
</tr>
</tbody>
</table>
<p><strong>Question 3</strong></p>
<p>Lets add more information to our inference. What is the probability of lung-cancer, given that we know that patient does smoke and also has bronchitis?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">q3</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">DAG</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lung&#39;</span><span class="p">],</span> <span class="n">evidence</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;smoke&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;bronc&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>

<span class="c1"># Finding Elimination Order: : 100%  1/1 [00:00&lt;00:00, 334.31it/s]</span>
<span class="c1"># Eliminating: xray: 100%  1/1 [00:00&lt;00:00, 338.47it/s]</span>
<span class="c1"># [bnlearn] &gt;Variable Elimination..</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>lung</p></th>
<th class="head"><p>phi(lung)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lung(0)</p></td>
<td><p>0.0546</p></td>
</tr>
<tr class="row-odd"><td><p>lung(1)</p></td>
<td><p>0.9454</p></td>
</tr>
</tbody>
</table>
<p><strong>Question 4</strong></p>
<p>Lets specify the question even more. What is the probability of lung-cancer or bronchitis, given that we know that patient does smoke but did not had xray?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">q4</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">DAG</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bronc&#39;</span><span class="p">,</span><span class="s1">&#39;lung&#39;</span><span class="p">],</span> <span class="n">evidence</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;smoke&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;xray&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 26%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>lung</p></th>
<th class="head"><p>bronc</p></th>
<th class="head"><p>phi(lung,bronc)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lung(0)</p></td>
<td><p>bronc(0)</p></td>
<td><p>0.1092</p></td>
</tr>
<tr class="row-odd"><td><p>lung(0)</p></td>
<td><p>bronc(1)</p></td>
<td><p>0.2315</p></td>
</tr>
<tr class="row-even"><td><p>lung(1)</p></td>
<td><p>bronc(0)</p></td>
<td><p>0.2001</p></td>
</tr>
<tr class="row-odd"><td><p>lung(1)</p></td>
<td><p>bronc(1)</p></td>
<td><p>0.4592</p></td>
</tr>
</tbody>
</table>
<p>The highest probability for the patient under these condition is that lung-cancer is true and bronchitus is true too (P=0.45). Note that, if you put xray=1, then the probability becomes even higher (P=0.67).</p>
</div>
</div>
<div class="section" id="determine-causalities-when-you-have-data">
<h2>Determine causalities when you have data<a class="headerlink" href="#determine-causalities-when-you-have-data" title="Permalink to this headline">¶</a></h2>
<p>Suppose that we have the medical records of hundreds or even thousands patients treatment regarding shortness-of-breath (dyspnoea). Our goal is to determine the causality across variables given the data set.</p>
<dl class="simple">
<dt>Steps to take</dt><dd><ol class="arabic simple">
<li><p>Import the data set.</p></li>
<li><p>Compute Directed Acyclic Graph by means of structure learning.</p></li>
<li><p>Compare to DAG to that of the expert-DAG.</p></li>
</ol>
</dd>
</dl>
<div class="section" id="compute-directed-acyclic-graph-from-data">
<h3>Compute Directed Acyclic Graph from data<a class="headerlink" href="#compute-directed-acyclic-graph-from-data" title="Permalink to this headline">¶</a></h3>
<p>Import and process teh data set (<a class="reference internal" href="#import-data"><span class="std std-ref">Import data</span></a>). For this use-case we will compute the best performing DAG given the data set. You only need to provide the data set into <code class="docutils literal notranslate"><span class="pre">bnlearn</span></code> <code class="xref py py-func docutils literal notranslate"><span class="pre">bnlearn.bnlearn.structure_learning.fit()</span></code>. More about Directed Acyclic Graphs can be found in the section <a class="reference internal" href="Create DAG.html#directed-acyclic-graphs"><span class="std std-ref">Directed Acyclic Graphs</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Structure learning on the data set</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">structure_learning</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># [bnlearn] &gt;Computing best DAG using [hc]</span>
<span class="c1"># [bnlearn] &gt;Set scoring type at [bic]</span>
</pre></div>
</div>
<p>The computations can take seconds to days or even never-ending, depending on the complexity of your data set and the method in <code class="docutils literal notranslate"><span class="pre">bnlearn</span></code> you choose. This use-case contains only 8 variables, each with two states and will be computed within seconds. If your data set is huge, and readily have suspicion you can use the black_list or white_list parameters (<a class="reference internal" href="whitelist_blacklist.html#black-and-white-lists"><span class="std std-ref">Black and white lists</span></a>).</p>
<p>Lets plot the learned DAG and examine the structure!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the DAG</span>
<span class="n">bnlearn</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="c1"># Plot differences between expert-DAG and the computed-DAG</span>
<span class="n">bnlearn</span><span class="o">.</span><span class="n">compare_networks</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">DAG</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-default" id="fig-asia-structurelearning">
<img alt="_images/asia_structurelearning.png" src="_images/asia_structurelearning.png" />
</div>
<p>A comparison with our initial expert-DAG shows few differences in <strong>red</strong>. As an example, we did not include the <em>either</em> variable, which describes either being lung-cancer or bronchitus.</p>
<div class="figure align-default" id="fig-asia-dag-vs-model">
<img alt="_images/asia_dag_vs_model.png" src="_images/asia_dag_vs_model.png" />
</div>
</div>
</div>
<div class="section" id="make-inference-when-you-have-data">
<h2>Make inference when you have data<a class="headerlink" href="#make-inference-when-you-have-data" title="Permalink to this headline">¶</a></h2>
<p>In this scenario we the goal is to make inferences across variables given the data set.</p>
<dl class="simple">
<dt>Steps to take</dt><dd><ol class="arabic simple">
<li><p>Import the data set</p></li>
<li><p>Compute Directed Acyclic Graph (DAG)</p></li>
<li><p>Compute Conditional Probability Distributions (CPDs)</p></li>
</ol>
</dd>
</dl>
<p>The first step is to import and pre-process the data set as depicted in <a class="reference internal" href="#import-data"><span class="std std-ref">Import data</span></a>. Then we compute the DAG by means of structure learning as depicted in <a class="reference internal" href="#compute-directed-acyclic-graph-from-data"><span class="std std-ref">Compute Directed Acyclic Graph from data</span></a>. To make inferences, we first need to compute the CPDs which we can do with <code class="xref py py-func docutils literal notranslate"><span class="pre">bnlearn.bnlearn.parameter_learning.fit()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Learning the CPDs using parameter learning</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">parameter_learning</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">methodtype</span><span class="o">=</span><span class="s1">&#39;bayes&#39;</span><span class="p">)</span>
<span class="c1"># Print the CPDs</span>
<span class="n">bnlearn</span><span class="o">.</span><span class="n">print_CPD</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>CPD of smoke:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>smoke(0)</p></td>
<td><p>0.495455</p></td>
</tr>
<tr class="row-even"><td><p>smoke(1)</p></td>
<td><p>0.504545</p></td>
</tr>
</tbody>
</table>
<p>CPD of bronc:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 19%" />
<col style="width: 40%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>smoke</p></td>
<td><p>smoke(0)</p></td>
<td><p>smoke(1)</p></td>
</tr>
<tr class="row-even"><td><p>bronc(0)</p></td>
<td><p>0.6009174311926605</p></td>
<td><p>0.31675675675675674</p></td>
</tr>
<tr class="row-odd"><td><p>bronc(1)</p></td>
<td><p>0.39908256880733944</p></td>
<td><p>0.6832432432432433</p></td>
</tr>
</tbody>
</table>
<p>CPD of lung:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 39%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>smoke</p></td>
<td><p>smoke(0)</p></td>
<td><p>smoke(1)</p></td>
</tr>
<tr class="row-even"><td><p>lung(0)</p></td>
<td><p>0.138348623853211</p></td>
<td><p>0.05333333333333334</p></td>
</tr>
<tr class="row-odd"><td><p>lung(1)</p></td>
<td><p>0.861651376146789</p></td>
<td><p>0.9466666666666667</p></td>
</tr>
</tbody>
</table>
<p>CPD of dysp:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 23%" />
<col style="width: 23%" />
<col style="width: 23%" />
<col style="width: 23%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>bronc</p></td>
<td><p>bronc(0)</p></td>
<td><p>bronc(0)</p></td>
<td><p>bronc(1)</p></td>
<td><p>bronc(1)</p></td>
</tr>
<tr class="row-even"><td><p>either</p></td>
<td><p>either(0)</p></td>
<td><p>either(1)</p></td>
<td><p>either(0)</p></td>
<td><p>either(1)</p></td>
</tr>
<tr class="row-odd"><td><p>dysp(0)</p></td>
<td><p>0.7508090614886731</p></td>
<td><p>0.7821064552661382</p></td>
<td><p>0.6189591078066915</p></td>
<td><p>0.12156934978817462</p></td>
</tr>
<tr class="row-even"><td><p>dysp(1)</p></td>
<td><p>0.24919093851132687</p></td>
<td><p>0.21789354473386183</p></td>
<td><p>0.38104089219330856</p></td>
<td><p>0.8784306502118254</p></td>
</tr>
</tbody>
</table>
<p>CPD of either:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 12%" />
<col style="width: 23%" />
<col style="width: 23%" />
<col style="width: 20%" />
<col style="width: 23%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>lung</p></td>
<td><p>lung(0)</p></td>
<td><p>lung(0)</p></td>
<td><p>lung(1)</p></td>
<td><p>lung(1)</p></td>
</tr>
<tr class="row-even"><td><p>tub</p></td>
<td><p>tub(0)</p></td>
<td><p>tub(1)</p></td>
<td><p>tub(0)</p></td>
<td><p>tub(1)</p></td>
</tr>
<tr class="row-odd"><td><p>either(0)</p></td>
<td><p>0.5098039215686274</p></td>
<td><p>0.8427672955974843</p></td>
<td><p>0.648876404494382</p></td>
<td><p>0.01302897644361059</p></td>
</tr>
<tr class="row-even"><td><p>either(1)</p></td>
<td><p>0.49019607843137253</p></td>
<td><p>0.15723270440251572</p></td>
<td><p>0.351123595505618</p></td>
<td><p>0.9869710235563894</p></td>
</tr>
</tbody>
</table>
<p>CPD of tub:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 58%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>tub(0)</p></td>
<td><p>0.0555455</p></td>
</tr>
<tr class="row-even"><td><p>tub(1)</p></td>
<td><p>0.944455</p></td>
</tr>
</tbody>
</table>
<p>CPD of xray:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 18%" />
<col style="width: 42%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>either</p></td>
<td><p>either(0)</p></td>
<td><p>either(1)</p></td>
</tr>
<tr class="row-even"><td><p>xray(0)</p></td>
<td><p>0.7716262975778547</p></td>
<td><p>0.0750711093051605</p></td>
</tr>
<tr class="row-odd"><td><p>xray(1)</p></td>
<td><p>0.22837370242214533</p></td>
<td><p>0.9249288906948395</p></td>
</tr>
</tbody>
</table>
<p>From this point on we can start making inferences given the DAG and the CPDs. For demonstration purposes I will repeat question 4.</p>
<p><strong>Question</strong></p>
<p>What is the probability of lung-cancer or bronchitis, given that we know that patient does smoke but did <strong>not</strong> had xray?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">bnlearn</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">DAG</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bronc&#39;</span><span class="p">,</span><span class="s1">&#39;lung&#39;</span><span class="p">],</span> <span class="n">evidence</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;smoke&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;xray&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">})</span>
</pre></div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 26%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>lung</p></th>
<th class="head"><p>bronc</p></th>
<th class="head"><p>phi(lung,bronc)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>lung(0)</p></td>
<td><p>bronc(0)</p></td>
<td><p>0.0797</p></td>
</tr>
<tr class="row-odd"><td><p>lung(0)</p></td>
<td><p>bronc(1)</p></td>
<td><p>0.1720</p></td>
</tr>
<tr class="row-even"><td><p>lung(1)</p></td>
<td><p>bronc(0)</p></td>
<td><p>0.2370</p></td>
</tr>
<tr class="row-odd"><td><p>lung(1)</p></td>
<td><p>bronc(1)</p></td>
<td><p>0.5113</p></td>
</tr>
</tbody>
</table>
<p>The highest probability for the patient under these condition is that lung-cancer is true and bronchitus is true too (P=0.51).</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bnlearn.structure_learning.html" class="btn btn-neutral float-right" title="bnlearn.structure_learning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Examples.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Erdogan Taskesen

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>